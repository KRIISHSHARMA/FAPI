# 1. INTRO

## 1.1 5G NR

-  FAPI is an interface, which defines the interface between MAC-Layer#2 and PHY â€“ Layer#1 for small cells.
 
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/2ee1a0d3-92b7-4afe-9102-57dc831c6416)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/e4a00306-d0d8-466c-b25e-38a50a6d5adb)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/af6200cd-5e64-482d-a94d-710d7ae5a070)


- Figure consists of 5 Core (AMF,UPF,etc.) and gNB
- 5G FAPI resides within the gNB element .
- Interfaces in 5G network (NG , Xn and F1)
- [NG interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) : The NG (Next Generation) interface in the context of 5G refers to the interface between the Next Generation Core (NGC) and the Radio Access Network (RAN)
- [Xn interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) : exists between these base stations viz. between gNB-gNB, between (gNB)-(ng-eNB) and between (ng-eNB)-(ng-eNB).
- [F1 interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) :  defines inter-connection of a gNB-CU and a gNB-DU supplied by different manufacturers.
- [F2 interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) : This interface lies between lower and upper parts of the 5G NR physical layer. It is also separated into F2-C and F2-U based on control plane and user plane functionalities.

- For 5G FAPI the MAC and PHY reside is a single element, resulting in FAPI existing as an internal interface within the gNB as shown below

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/442caf9c-fb2b-4c0e-817b-eebdecbbfbac)

## 1.2 PHY API

- Both control- and data-plane information is passed through the PHY API. However, each API message contains either control- or data-plane information, but never both.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/c097458b-e442-48de-bd49-ca385e22316e)

- Below is an example of how the different L2/L3 protocol layer will interact with the PHY API . in the example given below a PHY control entity is responsible for configuration procedures (P5). The MAC layer is responsible for the exchange of data-plane messages with the PHY (P7).
-  The PHY configuration sent over the P5 interface may be determined using SON techniques, information model parameters sent from an OAM system, or a combination of both methods. If carrier aggregation is supported, then one instance of the PHY API exists for each component carrier, as defined in 3GPP TS 38.104 [7].
  - [SON technique](https://www.snstelecom.com/son) : SON (Self-Organizing Network) technology is like a smart system for mobile networks. It helps save money by getting rid of the need for people to manually set up and manage the network. From the beginning, when the network is first set up, all the way through its operation, SON takes care of things like adjusting and fixing issues without needing constant human intervention. This not only makes the network work better for users but also makes it cheaper for the companies running the mobile network, helping them save money and improve their overall financial situation.
 - [OAM system](https://www.zte.com.cn/global/about/magazine/zte-technologies/2021/2-en/special-topic/6.html) : OAM technology is used to collect statistics on quality data such as packet loss, delay and jitter of traffic streams 

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/c157e057-367d-49c9-9e43-420f45dc393d)


![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/096aae09-893a-4e53-b3f9-2c074db53141)

- [source](https://www.5gtechnologyworld.com/what-is-5g-femto-application-platform-interface-5g-fapi-faq/)
- The 5G FAPI suite includes control for self-organizing networks (SON), medium access control (MAC), front end unit including digital front end (DFE), and analog beamforming (ABF) (Image: Small Cell Forum)

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/8ddb7f48-da6b-448b-bb67-9410994e2ec6)

- [source](https://www.techplayon.com/5g-fapi-femtocell-application-programming-interface/)
- There are two types of PHY  configuration messages are defined by the logical interface as P5 and P7
- P5 Logical Interface is  for PHY control configuration which is semi-static and is being generated by a PHY control entity.
- The P7 logical interface is for PHY data plane messages, P7 interface data configuration is generated once per slot and consists of following:
  - Slot configuration messages, which include information required by the PHY to encode and decode data
  - Downlink data messages to transfer **MAC PDUs to the PHY.**
  - Uplink data messages to transfer **MAC PDUs, Uplink Control Information ,Sounding Reference Signal and RACH PDUs from the PHY**
 
 # 2 PHY API PROCEDURES

 1. CONTROL CONFIG PROCEDURES (P5) :
    - P5 deals with PHY states (idle , configured and running)
    - The Control configuration procedures supported by the L1 FAPI over P5 interface are listed below:
       1. Initialization
       2. Termination
       3. Restart
       4. Reset
       5. Error notification
       6. Query
       7. Reconfiguration

2. DATA PLANE CONFIG PROCEDURES / SLOT (P7) : The slot procedures have two purposes. Firstly, they are used to control the DL and UL
frame structures. Secondly, they are used to transfer the slot data between the L2/L3 software and PHY. The slot procedures supported by the PHY API are
   - Transmission of a 1ms Subframe message
   - Synchronization of SFN/SF between the L2/L3 software and PHY
   - Transmission of the BCH transport channel
   - Transmission of the PCH transport channel
   - Transmission of the DLSCH transport channel and reception of ACK/NACK response
   - Transmission of the MCH transport channel
   - Reception of the RACH transport channel
   - Reception of the ULSCH transport channel and transmission of ACK/NACK response
   - Reception of the sounding reference signal
   - Reception of CQI and RI reporting
   - Reception of scheduling request information SR is a special Physical Layer message for UE to ask Network to send UL Grant (DCI Format 0_0 /0_1) so that UE can transmit PUSCH
- P7 defines what is transmitted and received over the air every subframe.
    

 # 2.1  Configuration Procedures (P5)

 - Occurs infrequently

   
![FAPI-State](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/9791c806-6c1f-45a3-a91b-2742f04632e7)

- PHY starts in IDLE mode , where MAC can query the PHY's capabilities using PARAM message sequence
- PHY can be moved from IDLE to CONFIGURED state by the MAC initiating the CONFIG message
- PHY in CONFIGURED state can be configured further , or have its PHY capabilities quried
- PHY can be moved from CONFIGURED to RUNNING state by the MAC initiating the START message sequence
- PHY in RUNNING state is transmitting over the air and provides a small cell service
- To stop the small cell the MAC must initiate the STOP message sequence


![rk-EH4WB3](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/64ec27cf-7df9-4054-be82-fe1339b1bf8b)

- Message control Procedures
  1. PARAM.request/PARAM.response
  2. CONFIG.request/CONFIG.response
  3. START.request
  4. STOP.request
  5. STOP.indication

- When timeouts for P5 request procedures are supported, P5 procedures (from request to response/indication that signals the end of the procedure) are expected to last no more than the time value declared in TLV 0x015F. If a procedure lasts more than that amount, L2/L3 software shall trigger a RESET.request for those P5 procedures that change PHY state.

![CAysGCg](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/7cb53f80-7ae7-461b-a37f-b5a85fc1e769)

 - [resource](https://hackmd.io/@MingHung/StudyBook/%2F%40MingHung%2FFAPI#2112-Config-message-exchange-procedure)
- [blog resource](https://www.techplayon.com/5g-fapi-femtocell-application-programming-interface/)
 
 # 2.1.1 INTIALIZATION 
 - This procedure moves the PHY from IDLE state to RUNNING state via CONFIGURED state
 - The different stages of initalization are :
   1. PARAM message exchange procedure
   2. CONFIG message exchange procedure
   3. START message exhange procedure

![vxFd9sV](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/90cd4860-e19b-4026-b7ec-585d3833eab8)

  
  
# 2.1.1.1 PARAM message exchange procedure































 
