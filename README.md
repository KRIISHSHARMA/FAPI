# 1. INTRO

## 1.1 5G NR

-  FAPI is an interface, which defines the interface between MAC-Layer#2 and PHY â€“ Layer#1 for small cells.
 
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/2ee1a0d3-92b7-4afe-9102-57dc831c6416)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/e4a00306-d0d8-466c-b25e-38a50a6d5adb)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/af6200cd-5e64-482d-a94d-710d7ae5a070)


- Figure consists of 5 Core (AMF,UPF,etc.) and gNB
- 5G FAPI resides within the gNB element .
- Interfaces in 5G network (NG , Xn and F1)
- [NG interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) : The NG (Next Generation) interface in the context of 5G refers to the interface between the Next Generation Core (NGC) and the Radio Access Network (RAN)
- [Xn interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) : exists between these base stations viz. between gNB-gNB, between (gNB)-(ng-eNB) and between (ng-eNB)-(ng-eNB).
- [F1 interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) :  defines inter-connection of a gNB-CU and a gNB-DU supplied by different manufacturers.
- [F2 interface](https://www.rfwireless-world.com/Tutorials/5G-NR-network-interfaces.html#:~:text=5G%20NR%20F1%20Interface&text=%E2%80%A2-,Functions%3A,Layer%20and%20Transport%20Network%20Layer.) : This interface lies between lower and upper parts of the 5G NR physical layer. It is also separated into F2-C and F2-U based on control plane and user plane functionalities.

- For 5G FAPI the MAC and PHY reside is a single element, resulting in FAPI existing as an internal interface within the gNB as shown below

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/442caf9c-fb2b-4c0e-817b-eebdecbbfbac)

## 1.2 PHY API

- Both control- and data-plane information is passed through the PHY API. However, each API message contains either control- or data-plane information, but never both.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/c097458b-e442-48de-bd49-ca385e22316e)

- Below is an example of how the different L2/L3 protocol layer will interact with the PHY API . in the example given below a PHY control entity is responsible for configuration procedures (P5). The MAC layer is responsible for the exchange of data-plane messages with the PHY (P7).
-  The PHY configuration sent over the P5 interface may be determined using SON techniques, information model parameters sent from an OAM system, or a combination of both methods. If carrier aggregation is supported, then one instance of the PHY API exists for each component carrier, as defined in 3GPP TS 38.104 [7].
  - [SON technique](https://www.snstelecom.com/son) : SON (Self-Organizing Network) technology is like a smart system for mobile networks. It helps save money by getting rid of the need for people to manually set up and manage the network. From the beginning, when the network is first set up, all the way through its operation, SON takes care of things like adjusting and fixing issues without needing constant human intervention. This not only makes the network work better for users but also makes it cheaper for the companies running the mobile network, helping them save money and improve their overall financial situation.
 - [OAM system](https://www.zte.com.cn/global/about/magazine/zte-technologies/2021/2-en/special-topic/6.html) : OAM technology is used to collect statistics on quality data such as packet loss, delay and jitter of traffic streams 

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/c157e057-367d-49c9-9e43-420f45dc393d)


![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/096aae09-893a-4e53-b3f9-2c074db53141)

- [source](https://www.5gtechnologyworld.com/what-is-5g-femto-application-platform-interface-5g-fapi-faq/)
- The 5G FAPI suite includes control for self-organizing networks (SON), medium access control (MAC), front end unit including digital front end (DFE), and analog beamforming (ABF) (Image: Small Cell Forum)

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/8ddb7f48-da6b-448b-bb67-9410994e2ec6)

- [source](https://www.techplayon.com/5g-fapi-femtocell-application-programming-interface/)
- There are two types of PHY  configuration messages are defined by the logical interface as P5 and P7
- P5 Logical Interface is  for PHY control configuration which is semi-static and is being generated by a PHY control entity.
- The P7 logical interface is for PHY data plane messages, P7 interface data configuration is generated once per slot and consists of following:
  - Slot configuration messages, which include information required by the PHY to encode and decode data
  - Downlink data messages to transfer **MAC PDUs to the PHY.**
  - Uplink data messages to transfer **MAC PDUs, Uplink Control Information ,Sounding Reference Signal and RACH PDUs from the PHY**
 
 # 2 PHY API PROCEDURES

 1. CONTROL CONFIG PROCEDURES (P5) :
    - P5 deals with PHY states (idle , configured and running)
    - The Control configuration procedures supported by the L1 FAPI over P5 interface are listed below:
       1. Initialization
       2. Termination
       3. Restart
       4. Reset
       5. Error notification
       6. Query
       7. Reconfiguration

2. DATA PLANE CONFIG PROCEDURES / SLOT (P7) : The slot procedures have two purposes. Firstly, they are used to control the DL and UL
frame structures. Secondly, they are used to transfer the slot data between the L2/L3 software and PHY. The slot procedures supported by the PHY API are
   - Transmission of a 1ms Subframe message
   - Synchronization of SFN/SF between the L2/L3 software and PHY
   - Transmission of the BCH transport channel
   - Transmission of the PCH transport channel
   - Transmission of the DLSCH transport channel and reception of ACK/NACK response
   - Transmission of the MCH transport channel
   - Reception of the RACH transport channel
   - Reception of the ULSCH transport channel and transmission of ACK/NACK response
   - Reception of the sounding reference signal
   - Reception of CQI and RI reporting
   - Reception of scheduling request information SR is a special Physical Layer message for UE to ask Network to send UL Grant (DCI Format 0_0 /0_1) so that UE can transmit PUSCH
- P7 defines what is transmitted and received over the air every subframe.
    

 ## 2.1  Configuration Procedures (P5)

 - Occurs infrequently

   
![FAPI-State](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/9791c806-6c1f-45a3-a91b-2742f04632e7)

- PHY starts in IDLE mode , where MAC can query the PHY's capabilities using PARAM message sequence
- PHY can be moved from IDLE to CONFIGURED state by the MAC initiating the CONFIG message
- PHY in CONFIGURED state can be configured further , or have its PHY capabilities quried
- PHY can be moved from CONFIGURED to RUNNING state by the MAC initiating the START message sequence
- PHY in RUNNING state is transmitting over the air and provides a small cell service
- To stop the small cell the MAC must initiate the STOP message sequence


![rk-EH4WB3](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/64ec27cf-7df9-4054-be82-fe1339b1bf8b)

- Message control Procedures
  1. PARAM.request/PARAM.response
  2. CONFIG.request/CONFIG.response
  3. START.request
  4. STOP.request
  5. STOP.indication

- When timeouts for P5 request procedures are supported, P5 procedures (from request to response/indication that signals the end of the procedure) are expected to last no more than the time value declared in TLV 0x015F. If a procedure lasts more than that amount, L2/L3 software shall trigger a RESET.request for those P5 procedures that change PHY state.

![CAysGCg](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/7cb53f80-7ae7-461b-a37f-b5a85fc1e769)

 - [resource](https://hackmd.io/@MingHung/StudyBook/%2F%40MingHung%2FFAPI#2112-Config-message-exchange-procedure)
- [blog resource](https://www.techplayon.com/5g-fapi-femtocell-application-programming-interface/)
 
 ## 2.1.1 INTIALIZATION 
 - This procedure moves the PHY from IDLE state to RUNNING state via CONFIGURED state
 - The different stages of initalization are :
   1. PARAM message exchange procedure
   2. CONFIG message exchange procedure
   3. START message exhange procedure

![vxFd9sV](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/90cd4860-e19b-4026-b7ec-585d3833eab8)

 - For SFN/SL Synchronization, the initialization procedure is completed when the PHY sends the L2/L3 software a SLOT.indication message.
- For Delay Management with Timestamps, the initialization procedure is completed when the PHY sends the L2/L3 software a START.response message.
- For Delay Management without Timestamps, the initialization procedure is completed when the PHY sends the L2/L3 software a TIMING.indication message.

## 2.1.1.1 PARAM message exchange procedure
- Its purpose is to allow the L2/L3 software to collect info about the PHY configuration an current state. (only in IDLE and CONFIGURED state)
- PHY returns the following info (PARAM.response) according to its current state

![KwfdWlq](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/5e572354-8604-492c-80f9-3a45769bae9e)
![P7p9uXU](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/97abe830-e7b2-44dd-81b8-9815c2e8f9b4)

- From the above figure , we can see that the PARAM message exchange is initiated by L2/L3 software sending a PARAM.request message to PHY.
- L2/L3 software may or may not (recommended) start a guard timer to wait for the response from L1 .
- If everything is going great PARAM.response is sent by PHY as a response
- In the IDLE and CONFIGURED states, this message will include the current PHY state and a list of configuration information
- In the RUNNING state, this message will indicate an INVALID_STATE error. To determine the PHY capabilities it must be moved to the CONFIGURED state using the termination procedure

- [TLV](https://devopedia.org/tlv-format) : TLV (Tag-Length-Value) is a binary format used to represent data in a structured way
![1688 1676742752](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/d6bf1ad1-36b4-4d0a-a7c7-90ec7559d330)

- if L2/L3 does not signal any TLVs , the message length in the genereic header = 0

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/d8b03246-25c7-49b0-8b8f-722e1993ad1d)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/6e07c463-df76-446a-aba7-7ed15cf047df)

- uint16_t : unassigned integer of 16 bits
- uint8_t : unassigned integer of 8 bits 

## 2.1.1.2 Config message exchange procedure
- Its purpose is to allow the L2/L3 software to configure the PHY.
- Can be used in any state though there are some small differences depending on PHY state
  1. If the PHY is in the IDLE state, the CONFIG.request message, sent by the L2/L3 software, must include all mandatory TLVs. The mandatory TLVs are indicated by the PHY in the PARAM.response message. If all mandatory TLVs are included, and set to values supported by the PHY, L1 will return a CONFIG.response message, indicating it is successfully configured and has moved to the CONFIGURED state. If the CONFIG.request message has missing mandatory TLVs, invalid TLVs, or unsupported TLVs, the PHY will return a CONFIG.response message, indicating an incorrect
  2. If the PHY is in the CONFIGURED state, the CONFIG.request message, sent by the L2/L3 software, may include only the TLVs that are required to change the PHY to a new configuration. If the PHY supports these new values, it will return a CONFIG.response message, indicating it has been successfully configured. However, if the CONFIG.request message includes invalid TLVs, or unsupported TLVs, the PHY will return a CONFIG.response message, indicating an incorrect configuration. In this case, all received TLVs will be ignored and the PHY will continue with its previous configuration. In both cases, if the PHY receives a CONFIG.request while in the CONFIGURED state it will remain in the CONFIGURED state.
  3. If the PHY is in the RUNNING state, then a limited subset of CONFIG TLVs may be sent in a CONFIG.request message. The permitted TLVs are indicated by the PHY in PARAM.response. If the CONFIG.request message has invalid TLVs, or TLVs which must not be reconfigured in the RUNNING state, the PHY will return a CONFIG.response message, indicating an incorrect configuration. In this case, it will remain in the RUNNING state and all received TLVs will be ignored.

![4XWZx44](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/0a6079f0-af44-487d-9745-8816f919fa21)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/ccc87332-cc24-4c20-ad59-54dd4f2ad3fb)
![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/c7e179bf-f165-4d2d-8e83-b08aeb24dc17)

## 2.1.1.3 Start message exchange procedure
- Its purpose is to instruct a configured PHY to start transmitting as a gNB.
- L2/L3 software initiates this procedure by sending a START.request message to the PHY
- If the PHY is in the CONFIGURED state, and it supports SFN/SL-based synchronization, it will issue a SLOT indication. After the PHY has sent its first **SLOT.indication** message, it enters the RUNNING state.
- If the PHY is in the CONFIGURED state, and it supports `Delay Management with Timestamps` (see section 2.2.1.1), it will issue a **START.response**, after which it enters the RUNNING state.
- If the PHY is in the CONFIGURED state, and it supports Delay Management without Timestamps (see section 2.2.1.2), it will issue a  **TIMING.indication**, after which it enters the RUNNING state.
- If the PHY receives a **START.request** in either the IDLE or RUNNING state, it will return an **ERROR.indication** including an **INVALID_STATE** error.

![nhqOidF](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/07e637a2-f4e5-4687-ac43-9df803929064)

## 2.1.2 Termination (stop)
- The termination procedure is used to move the PHY from the RUNNING state to the CONFIGURED state. This stops the PHY transmitting as a gNB.
- initiated by the L2/L3 software sending a **STOP.request** message.
- If the **STOP.request** message is received by the PHY while operating in the RUNNING state, it will stop all TX and RX operations and return to the CONFIGURED state. When the PHY has completed its stop procedure, a STOP.indication message is sent to the L2/L3 software.
- If the STOP.request message was received by the PHY while in the IDLE or
CONFIGURED state, it will return an **ERROR.indication** message including an **INVALID_STATE** error. However, in this case the PHY was already stopped.

![PBwLhZ7](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/0f505c92-28a7-4273-9461-f7d0d156683a)

## 2.1.3 Restart

- It can be used by the L2/L3 software When it needs to stop transmitting, but later wants to restart transmission using the same configuration.
- To complete this procedure, the L2/L3 software can follow the
STOP message exchange shown in Figure 2-6. This moves the PHY to the
CONFIGURED state. To restart transmission, it should follow the START message exchange, shown in Figure 2-5, moving the PHY back to the RUNNING state.

![j3L8Ool](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/3096aea9-5e23-4d8b-8632-f7d88cd2b89e)

## 2.1.4 Reset
- This procedure is used when the L2/L3 software wants to return the PHY to the IDLE state. Under normal conditions, this can only be achieved by terminating the PHY (as shown in Figure 2-6) and then resetting the PHY.
- When L2 detects P5 timeout, it instead invokes RESET.request directly.
- For a dedicated PHY or PHY Group contexts, the RESET procedure is complete when **RESET.indication** is received. For common context, the RESET procedure is complete when **CCONTEXT_READY.indication** is received.

![P2TIXoz](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/6c0bd858-18d2-43a8-b95f-954a93587ed0)

## 2.1.5 Reconfigure
- 2 Methods :
  1. a major reconfiguration where the PHY is stopped
  2. a minor reconfiguration where the PHY continues running

- Major Reconfig : It is used when the L2/L3 software wants to make significant changes to the configuration of the PHY
  - The STOP message exchange, shown in Figure 2-6, is followed to halt the PHY and move it to theCONFIGURED state. The CONFIG message exchange, shown in Figure 2-4, is used to reconfigure the PHY. Finally, the START message exchange, shown in Figure 2-5, is followed to start the PHY and return it to the RUNNING state.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/dca8e80c-96ef-40f8-a17d-8fea22ac9fa6)


- Minor Reconfig : The minor reconfiguration procedure is shown in Figure 2-10. It is typically used in conjunction with a RRC system information update.
- In the slot where the L2/L3 software requires the configuration change it sends the CONFIG.request message to the PHY. Only a limited subset of CONFIG TLVs may be sent, these are indicated by the PHY in PARAM.response.
- Reconfiguring the PHY while in the RUNNING state has a further restriction, the CONFIG.request message must be sent before the DL_TTI.request and UL_TTI.request message.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/ea64af9b-1817-4820-afc4-5ffb20eaa6e5)


## 2.1.6 Query
- It is used by the L2/L3 software to determine the configuration and operational status of the PHY
- The PARAM message exchange, shown in Figure 2-3, is used. This signalling sequence can be followed when the PHY is stopped, in the IDLE state and, optionally, the CONFIGURED state.

## 2.1.7 Notification
- The PHY sends a notification message when it has an event of interest for the L2/L3 software. Currently, there is one notification message called ERROR.indication.
- It is used by the PHY to indicate that the L2/L3 software has sent invalid information
to the PHY.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/fd21b4fa-cab4-40ed-ba82-18721ffb7108)

## 2.1.8 Protocol Negotiation
- The procedure allows L2/L3 and PHY to ensure that the same FAPI version is used.
  1. **Step 1** : Protocol negotiation triggered by L2/L3 sending a **PARAM.request** message with a `protocolVersion` indicating a FAPI protocol version supported by L2/L3.
     - Note: typically, this would be the highest FAPI version that L2/L3 supports.
   2. **Step 2** : PHY replies to MAC with a **PARAM.response** message which contains :
      1. phyFapiProtocolVersion: the highest FAPI protocol version that PHY supports
      2. phyFapiNegotiatedProtocolVersion: the FAPI version that PHY assumes in subsequent P5/P7 exchanges with L2/L3.

- After step 2, both L2/L3 and PHY are assumed to use the same protocol version, as indicated by phyFapiNegotiatedProtocolVersion.
- **Protocol negotiation can only happen when all defined PHYs are in IDLE state.**

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/99eee73c-631f-4dcb-8572-31da8a850413)

- **PHY GROUPS** :The set of all PHYs supported by the PHY Layer is partitioned into PHY Groups. P5 APIs terminating in one PHY Group cannot impact or characterize other PHY Groups or PHYs belonging to other PHY Groups.

## 2.1.9 PHY Instantiation
- This process describes the PHY Profile discovery and selection process, which leads to defining PHYs (and corresponding PHY IDs).
  1. **Step 1 and 2 (PHY Profile Discovery)** : L2/L3 uses the PHY Query Procedure (steps 1 and 2 in the figure) towards Common or PHY Group Context (see section 2.1.10), to discover the supported PHY Profiles and a map indicating which PHY and DFE(digital front end) profiles are pairable.
     - Note: Some PHY implementations may pre-define PHY IDs (e.g. < 255), in which case this procedure is not needed
  2. **Step 3 and 4 (DFE profile Discovery)** : L2/L3 uses the DFE Query Procedure in SCF-223 [9] (steps 3 and 4 in the figure) towards DFE, to discover the supported DFE Profiles
  3. **Step 5 (PHY PROFILE SELECTION)** : L2/L3 selects a PHY profile , via the **CONFIG.reuest** message towards COmmon or PHY Group Context.
     - **Note: Common or PHY Group Context does not support PHY (IDLE, CONFIGURED, RUNNING) states, so the state diagram from Figure 2-1 does not apply to PHY ID#255.**
   4. **Step 6 and 7 (PHY definition)** : PHY IDs < 255 are defined (but cannot be configured), based on the selected profile (step 6).
      - CONFIG.response (step 7) announces successful configuration, if PHY Definition succeeds. If unsuccessful, an error code will indicate the failure cause and the PHY Instantiation fails.
   5. **Step 8 and 9 (DFE profile selection)** : L2/L3 selects a DFE profile, via the DFE **CONFIG.request** message (step 8).
      - DFE CONFIG.response (step 9) announces successful configuration. If unsuccessful, an error code will indicate the failure cause the PHY Instantiation fails.
   6. **Step 10 (FEU Configuration and initiallization)** : L2/L3 executes the Configuration and Initialization procedures towards DFE and RF (step 8).
      - The config and initialization procedures towards FEU is in SCF-225[10]
   7. **Step 11 (PHY instantiation)** : When the DFE and RF have both entered RUNNING state, PHY IDs defined through Profile selection become configurable (step 11), after successful DFE and PHY Profile selection.If newly defined, these PHY IDs may be considered IDLE.


- IF PHY IDs existed in any state (IDLE/CONFIGURED/RUNNING) prior to any of the PHY Profile Selection and DFE Profile Selection steps, they remain in the same states, as long as none of their capabilities or configurations are not impacted by the PHY or DFE Profile Selections, otherwise ERROR.indication will be triggered by these PHY IDs.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/10d0f62d-d820-484b-86b4-df62f4c424b6)

## 2.1.10 Common and PHY Group Contexts
- When a supervisory PHY concept (e.g. PHY ID 255 or PNF in SCF-225 [10]) is supported, the Common Context is supported in this supervisory PHY.
- only terminates P5 but not P7
- Cannot be in PHY RUNNING state
- can be queried (section 2.1.6)
- can be configured
- can be reset
- The scope of a P5 API :
  1. A specific PHY : PHY ID is dedicated (eg PHY ID < 255) NO PHY group may be associated with the API
  2. Common Context : PHY Group Identifier is absent and PHY ID is common (eg PHY ID = 255)
  3. PHY Group context : PHY Group Identifieris present ; in this case PHY ID must be common (eg PHY ID =255)

## 2.1.11 PHY/FEU Interface
- In some cases for eg splt 7.2x PHY and FEU interaface may be subject to disconnection or synchronization events.These events may be observable at L2/L3 software, via PHY (P5 interface), or via FEU (P19-C interface in SCF-223 [9]).
- An L2 that can observe such events, shall take the following actions:
1. When a PHYâ€™s associated FEU is determined to have become disconnected:
  - L2/L3 software shall transition the corresponding PHY and FEU to Idle, via the
  mechanisms in section 2.1.
  - L2/L3 software shall re-query the FEUâ€™s capability (as well as any associated
PHYâ€™s capability), after the FEU is determined to have been reconnected.
2. When a PHY or its associated FEU is determined to have become
desynchronized:
  - L2/L3 software shall stop any RUNNING PHY, via the mechanisms in section
  2.1
  - When the PHY and its associated FEU are both determined to be
  synchronized, L2 may transition the PHY to RUNNING state, via the
  mechanisms in section 2.1
- Query

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/3f4ff26e-f686-4b0e-9712-776f6219edc1)

# 2.2 SLOT PROCEDURE (P7) 
- Used to control control the DL and UL frame structure
- Used to transfer slot data between the L2/L3 software and PHY.
- Slot procedures supported by the PHY API are :
  1. Transmission of a 62.5us, 125us, 250us, 500us or 1ms SLOT message
  2. Synchronization of SFN/Slot between the L2/L3 software and PHY
  3. Transmission of the BCH transport channel
  4. Transmission of the PCH transport channel
  5. Transmission of the DL-SCH transport channel
  6. Transmission of the downlink control information (DCI)
  7. Transmission of the CSI reference signal
  8. Reception of the RACH transport channel
  9. Reception of the UL-SCH transport channel
  10. Reception of the uplink control information (UCI)
  11. Reception of the sounding reference signal

- P7 messages - Main data path interface
  1. DL_TTI.request
  2. UL_TTI.request
  3. SLOT.indication
  4. UL_DCI.request
  5. TX_Data.request
  6. RX_Data.indication
  7. CRC.indication
  8. UCI.indication
  9. RACH.indication

## 2.2.1 DELAY MANAGEMENT 
- This section describes two delay management mechanisms, based on receive window maintained at L1, per message type.
- Note that receive windows are anchored to slots. The slot being anchored to is specific to each of the PDU(s) carried in the message.
- In simpler terms, this section is talking about two ways to manage delays in a communication system. The delays are based on something called a "receive window," which is like a time frame during which a message is expected to be received.
- Imagine you're sending a message that contains different types of information. For example, let's say you're sending a message that includes both a picture and a video. Each type of information has its own time frame (receive window) during which it should be received.

  -  e.g. if a [DL_TTI](https://devopedia.org/5g-nr-transmission-time-interval).request carries a 15 kHz PDSCH PDU and a 30 kHz SSB PDU, the 15 PDSCH PDU reception shall be handled according to the Rx window for the 15 kHz slot and the SSB PDU reception shall be handled according to the Rx window for the 30 kHz slot, relevant to the DL_TTI.request message.
 
  -  So, in the example given, if your message includes a 15 kHz picture and a 30 kHz video, each part of the message has its own specific time frame for when it should be received. The system is designed to handle the reception of the 15 kHz picture based on a certain time frame (anchored to a slot related to 15 kHz), and the 30 kHz video is handled based on a different time frame (anchored to a slot related to 30 kHz).
 
  -  Essentially, it's a way to make sure that different types of information within a message are processed and received at the right times, depending on their specific characteristics.


## 2.2.1.1 Delay Management with Timestamps
- For PHYs supporting both Delay Management and the nFAPI message format, the supported slot procedures are as documented in section 2.1.3 of SCF-225 [10].

## 2.2.1.2 Delay Management without Timestamps
- Where L2 and L1 cannot rely on time stamps, it is still possible to support Delay Management, as described in this section, to ensure that P7 slot procedures occur in a timely fashion.


![dwvLlez](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/57837d03-563d-4c88-bdf1-f525c3fda4f2)

- this section describes a method of managing delays in communication without relying on timestamps, using a designated time window, and constructing timing reports for communication between L1 and L2. The provided figure illustrates a sequence where late-arriving messages trigger timing indications for corrective actions.

1. a PHY instance expects P7 slot-based messages from VNF to reach the instance in a Receive Time Window interval, that PHY maintains to buffer and process time-critical P7 messages (DL_TTI.request, UL_TTI.request, UL_DCI.request, TX_DATA.request), to apply at their targeted slots.

 - during this designated time window, the PHY instance is prepared to buffer and process these time-sensitive messages. The goal is to make sure that these messages are received and applied at the specific time slots they are intended for, ensuring timely and accurate communication.


2. a Receive Timing Window is characterized by the following parameters, illustrated in Figure 2-11 of SCF-225 [10]:
   1. a size (Timing Window)
   2. offset prior to the targeted slot (<msg> Timing offset, where <msg> is one of the above-listed time-critical messages)
      ![Q3kMUjC](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/9221cfbd-2c59-4d4e-b086-612b151b2528)


3. relevant P7 messages for Slot S received by PHY Receive Window mechanism:
   
   1. **Inside the Timing Window interval**: Messages received during this time frame are dealt with right away. These messages typically involve actions related to sending data (transmission), receiving data (reception), or configuring settings. The actions are applied to a designated time slot called Slot S.
   2. **Outside the Timing Window interval**: Messages arriving outside this designated time window are tagged by the PHY as either "too early" or "too late," depending on when they show up. These tagged messages are then collected to create a timing report, which is sent to Layer 2 (L2).


5. the headers of P7 messages are not assumed to signal any time stamps.

7. the L1 -> L2 timing report from 3.B above is TIMING.indication, as described in section 03.4.1A, which requires no time stamps in P7 messages.
A. **TIMING.indication may be event-driven (by too-early, too-late events), or periodic, or both, per configuration.**

8. an initial TIMING.indication message is triggered by transition of PHY into RUNNING state.
   1. A. DL/UL Node Sync messages are not needed for the timestamp-free Delay Management mechanism in this section.
   2. B. slot-level timing awareness between L2 and L1 may make use of TIMING.indication
   3. C. L2 can adjust its transmission window based on TIMING.indication

# SFN (System Frame Number):
1. SFN represents the System Frame Number, a unified time reference used to synchronize all nodes in the entire 5G NR network, including User Equipment (UE) and base stations.
2. An SFN consists of a continuous set of 10 subframes, each subframe lasting 1 millisecond, making a total of 100 milliseconds. SFN is used to synchronize the system clock and coordinate communication between nodes

# DL_TTI (Downlink Transmission Time Interval):
1. DL_[TTI](https://devopedia.org/5g-nr-transmission-time-interval) refers to the time interval used for downlink data transmission.
2. Base stations can allocate DL_TTI resources to different UEs for downlink data transmission as needed.
3. During each DL_TTI, the base station schedules and allocates wireless resources for UE data transmission.
4. UEs can obtain information about their downlink data transmission resource allocation by parsing Physical Downlink Control Channel (PDCCH) messages.


## 2.2.2 SLOT signal
- This section specifically applies to Physical Layer (PHY) implementations that support synchronization with Systen frame Number (SFN) and Slot (SL), as detailed in section 2.2.3.

- A SLOT.indication message is sent from the PHY, to the L2/L3 software, indicating the start of a slot.

- The periodicity of the SLOT.indication message is dependent on the numerology and illustrated in Figure 2-18, where the number of SLOT.indication messages per subframe is highlighted

![sAYiyqk](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/af276000-e432-4f2a-940e-7af5e574cb9b)

## 2.2.3 SFN/SL Synchronization
- The SFN/SL synchronization procedure is used to maintain a **consistent SFN/SL value between the L2/L3 software and PHY** . Maintaining this synchronization is important since different subframes and slots have different structures.

- Two options are provided by the PHY API
   1. Option 1: SFN/SL Configuration by L2/L3 Software
      1. Initialization:
         1. The PHY is set up to rely on the SFN/SL values provided by the L2/L3 software during the initial startup synchronization.
         2. This involves configuring the PHY with the specific SFN/SL values communicated by the L2/L3 software.
       2. Maintenance:
          1. Ongoing synchronization is achieved by continuously using the SFN/SL values provided by the L2/L3 software.
          2. The PHY regularly checks for updates or changes in the SFN/SL values from the L2/L3 software to maintain synchronization.

 2. Option 2: PHY Initialization of SFN/SL for Synchronous L2/L3 Software
    1. Initialization:
       1. The PHY takes the lead in initializing SFN/SL values, ensuringsynchronous operation with the L2/L3 software during startup synchronization.
       2. This involves the PHY setting its own SFN/SL values and configuring the L2/L3 software to synchronize with these values.
     2. Maintenance:
        1. The synchronization is maintained by the PHY actively ensuring that the L2/L3 software remains synchronized with its SFN/SL values.
        2. The PHY may periodically update or adjust its SFN/SL values, and the L2/L3 software adapts to these changes to stay synchronized.

- The choice between Option 1 and Option 2 is made during the compilation of the software, determining which synchronization strategy will be employed.
- This compile-time decision defines how the PHY and L2/L3 software will interact in terms of SFN/SL initialization and maintenance.


## 2.2.3.1 L2/L3 software is master
### Start up procedure
1. After successful configuration the L2/L3 software sends a START.request message to move the PHY to the RUNNING state

2. When the L2/L3 software is configured as master the initial PHY SFN/SL = M, where M could be any value. In the SLOT.indication message, SFN/SL = M

3. The L2/L3 software sends a DL_TTI.request message to the PHY containing the correct SFN/SL = N
  
4. The PHY uses the SFN/SL received from the L2/L3 software. It changes its
internal SFN/SL to match the value provided by the L2/L3 software

![K0EqXxv](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/4d1eb35e-6892-43bf-a357-d82328bad34d)

### Maintenance procedure 
1. The PHY sends the SLOT.indication message with SFN/SL = M.
2. The L2/L3 software sends a DL_TTI.request or UL_TTI.request message to the PHY containing SFN/SL = N
3. If SFN/SL M = N
   - The PHY received the SFN/SL it was expecting. No SFN/SL synchronization is required
4. If SFN/SL M â‰  N
 - The PHY received a different SFN/SL from the expected value. SFN/SL synchronization is required
 - The PHY uses the SFN/SL received from the L2/L3 software. It changes its internal SFN/SL to match the value provided by the L2/L3 software
 - The PHY returns an ERROR.indication message indicating the mismatch

![xTXu5fA](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/c44fe3d2-4d19-4383-9f97-70fc09b82b2f)

# Why does the PHY need to send SFN/SL?
- However, itâ€™s possible the SFN/SL synchronization was unintended, and due to a L2/L3 software issue. The generation of an ERROR.indication message, with expected and received SFN/SL values, should allow the L2/L3 software to perform a correction with a further SFN/SL synchronization.

# 2.2.3.2 L1 PHY is master
### Start-up Procedure
1. After successful configuration the L2/L3 software sends a START.request message to move the PHY to the RUNNING state
2. If the L1 software is configured as master, the initial PHY SFN/SL = M. The value of M is not deterministic, and could have been set by an external mechanism, such as GPS.
3. The PHY sends a SLOT.indication message to the L2/L3 software, with SFN/SL = M. The L2/L3 software uses the SFN/SL received from the PHY. It changes its internal SFN/SL to match the value provided by the PHY
4. The L2/L3 software sends a DL_TTI.request or UL_TTI.request message to
the PHY containing SFN/SL = M

![sguJvfQ](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/32c8a2a6-93c9-40da-9f4e-09554b264650)

### Maintenance Procedure
1. In this example, the L1 PHY is expecting the next DL_TTI.request or UL_TTI.request to contain information regarding frame M. The procedure followed is:
2. The PHY sends a SLOT.indication message to the L2/L3 software, with SFN/SL = M
3. The L2/L3 software sends a DL_TTI.request or UL_TTI.request message to the PHY containing SFN/SL = N
4. If SFN/SL M = N
   - The PHY received the SFN/SL it was expecting. No SFN/SL synchronization is required

5. If SFN/SL M â‰  N
   - The PHY received a different SFN/SL from the expected value. SFN/SL synchronization is required
   - The PHY discards the received DL_TTI.request or UL_TTI.request message
   - The PHY returns an ERROR.indication message indicating the mismatch

- This SFN/SL synchronization procedure will continue to discard DL_TTI.request request or UL_TTI.request messages and emit ERROR.indication messages until the L2/L3 software corrects its SFN/SL value.

![atSOjWJ](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/e79c718d-180c-4a32-8649-f4a3c6ee6fc2)

## 2.2.3a Slot Numerology
1. Slot Value Setting in L2-initiated Slot-carrying P7 API:
   - The slot value in the L2-initiated Slot-carrying P7 API is set based on the highest numerology configured among all numerologies across both uplink and downlink traffic directions and channels.
   - This means that the slot value is determined by the highest numerology, ensuring consistency and synchronization in the communication system.
  
2. Channel-specific PDUs in P7 API:
   - Channel-specific PDUs initiated by L2 shall only be carried in those P7 APIs where the slot starts, according to the P7 slot numerology, coincide with the start of the channel slot based on the Channel PDU numerology.
   - This rule ensures that Channel-specific PDUs are appropriately aligned with the timing specified by the numerology configurations.

3. Example Illustration:
   - An example is provided to illustrate the concept: If the highest P7 numerology is 60 kHz, and the Channel PDU numerology is 15 kHz (e.g., PUSCH PDU):
     - In the UL_TTI.request API, these 15 kHz PDUs are expected only when values of 60 kHz slots are divisible by 4.
     - This example demonstrates the specific conditions under which certain PDUs are expected in the UL_TTI.request API based on numerology configurations.


## 2.2.4 API message order
- **PHYs supporting Delay Management shall ignore any constraints relating to SLOT.indication or the relative order in which messages arrive for a particular slot. Instead, messages are expected in to arrive according to their Receive Windows, as documented in section 2.1.3.5 of SCF-225 [10].**

- The PHY API has constraints of when certain messages can be sent, or will be received, by the L2/L3 software.
1. The downlink API message constraints

      1. **SFN/SL in SLOT.indication and DL_TTI.request:**
         1. The SFN/SL information included in the SLOT.indication message is expected to be present in the corresponding DL_TTI.request.
         2. This ensures synchronization and consistency in the timing information between different messages.

      2. **Reconfiguration with CONFIG.request:**
         1.  If the PHY is being reconfigured using the CONFIG.request message, it must be the first message for the slot.
         2.  This ensures that any reconfiguration happens before other slot-related messages.

     3. **Skip_blank_DL_CONFIG and Skip_blank_UL_CONFIG Options:**
        1. If the Skip_blank_DL_CONFIG option is indicated during the PARAM procedure, the DL_TTI.request can be optionally skipped when there is nothing to schedule.
        2. Similarly, if the Skip_blank_UL_CONFIG option is indicated, the UL_TTI.request can be optionally skipped when there is nothing to schedule. Otherwise, these requests must be sent for every downlink and uplink slot, respectively.

      4. **TX_DATA.request and UL_DCI.request Messages:**
         1. The TX_DATA.request and UL_DCI.request messages are **optional**, meaning they are not required in every downlink slot.
         2. Their inclusion depends on whether there is data to transmit or control information to convey.
 
      5. **Indication of Multiple Instances for DL_TTI.request, UL_TTI.request, UL_DCI.request, and TX_DATA:**
         1. L1 (Layer 1) may indicate whether it can expect more than one instance of certain messages (DL_TTI.request, UL_TTI.request, UL_DCI.request, TX_DATA) for a slot.
         2. If supported, L2 (Layer 2) may configure L1 to expect only a specific number of instances for these messages in a slot.

      6. **Possibility of Multiple TX_DATA.request Instances with Mini-Slot Usage:**
         1. In the case of mini-slot usage, there can be more than one instance of the TX_DATA.request.
         2. This allows the PHY to minimize latency by transmitting data in smaller time intervals within a slot.

![Bkrwo5mVh](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/97dfcd78-58f5-4bb8-b3a9-d838de77fc57)

2. The uplink API message constraints

- **The UL API messages are optional. It is not a requirement that they are sent in every slot.**
- If present, the messages can be in any order
  1. The **CRC.indication** message is included if uplink data PDUs were expected in the slot.
  2. The **RX_DATA.indication** message is included if uplink data PDUs were expected in the slot.
  3. The **UCI.indication** message is included if UCI PDUs were expected in the slot.
  4. The **RACH.indication** message is included if any RACH preambles were detected in the slot
  5. The **SRS.indication** message is included if any sounding reference
symbol information is expected in the slot.
  
- L1 may indicate whether it can generate more than one instance of CRC.indication, RX_DATA.indication, UCI.indication, RACH.indication, SRS.indication or DL_TTI.response per slot and subcarrier spacing. If supported by L1, L2 may configure L1 to limit itself to only one instance of the CRC.indication, RX_DATA.indication, UCI.indication, RACH.indication, and SRS.indication messages per slot and subcarrier-spacing.

- There can be more than one instance of the CRC.indication, RX_DATA.indication, UCI.indication, RACH.indication, and SRS.indication messages if more than one subcarrier spacing finishes in the same slot. As an example, from Figure 2-18, slot 7 for u=3 completes at the same time as slot 1 for u=1.

![sAYiyqk](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/41a6cfa6-24af-40b2-830f-83dde6218b4f)

- There can be more than one instance of the CRC.indication and RX_DATA.indication if mini-slot is used. This allows the PHY to minimize latency.

![SkWgn9QNn](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/b0580502-f480-480b-ab4c-f66ad6e62f4d)


## 2.2.5 Downlink
- The procedures relating to downlink transmission are described in this Section.

## 2.2.5.1 BCH
- The BCH transport channel is used to transmit the Master Information Block (MIB) information to the UE
- It has a periodicity of 80ms.BCH payload is carried using the PBCH physical channel. Together with the PSS and the SSS synchronization signals, PBCH forms the Synchronization Signal Block (SSB),

![rkZW1i74h](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/f8e86feb-8eb6-4bfe-94ba-2170e629d6e2)
![rk8B1kEE3](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/ca5e6ead-d855-48eb-9a8b-eeed00a8862c)
![Hk__Jk443](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/d3dc5a48-1c08-443a-ac27-db42ed809131)


## 2.2.5.2 PCH
- The PCH transport channel is used to transmit paging messages to the UE
- The UE has specific paging occasions where it listens for paging information Figure 2 28
- The L2/L3 software is responsible for calculating the correct paging occasion for a UE. The PHY is only responsible for transmitting PCH PDUs when instructed by the DL_TTI.request message.

![BkxFsSQH3](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/d6d7aa9e-c96d-4612-acb0-5c8a765a85fd)

- To transmit a PCH PDU the L2/L3 software must provide the following information:
  - In DL_TTI.request a PDSCH PDU and PDCCH PDU are included.
  - In TX_DATA.request a MAC PDU containing the paging message is included.

## 2.2.5.3 DL-SCH
![285506746-020732cb-1e6b-45a9-b14a-e486dae19033](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/535d8f6e-413c-4ae1-bd76-97a05d5039fd)
![NR_ChannelStructure_01](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/243f3765-dec6-4601-88bc-50acdfaf8727)

-[photo reference](https://www.sharetechnote.com/html/5G/5G_ChannelMapping.html)

-[more on this](https://github.com/KRIISHSHARMA/5G_TECHNOLOGY_ARCHITECTURE_AND_PROTOCOLS/blob/main/5G_NR_AIR_INTERFACE.md#5g-nr-logical-channels)

- DL-SCH data transfer :	Do everything needed to perform DL Data Transfer (DCI-Scheduling, HARQ etc)
- The **DL-SCH transport channel** is used to send data from the gNB to a single UE.
- [HARQ](https://www.sharetechnote.com/html/5G/5G_HARQ.html) is always applied on the DL-SCH transport channel at least for unicast PDSCH.
- Therefore, when scheduling a downlink PDSCH transmission which will require [HARQ](https://www.sharetechnote.com/html/5G/5G_HARQ.html)-ACK feedback from UE, **the L2/L3 software has to schedule uplink transmission on PUCCH or PUSCH for the UE to feed back an ACK/NACK response.**
- To transmit a DL-SCH PDU, the L2/L3 software must provide the following information:

 1. In **DL_TTI.request** a PDSCH PDU and PDCCH PDU are included. The PDCCH PDU contains control regarding the DL frame transmission
 2. In **TX_DATA.request** a MAC PDU containing the data is included
 3. At the expected slot **[UCI](https://github.com/KRIISHSHARMA/5G_TECHNOLOGY_ARCHITECTURE_AND_PROTOCOLS/blob/main/5G_NR_AIR_INTERFACE.md#uci-ul-control-information) HARQ** information is included in a later **UL_TTI.request**, where the timing of this message is variable. The HARQ can be sent on the PUSCH or PUCCH, therefore, the information of the HARQ response on the uplink is sent in either:

    - **PUSCH PDU** â€“ is used if the UE is scheduled to transmit data and the ACK/NACK response
    - **PUCCH PDU** â€“ is used if the UE is just scheduled to transmit the ACK/NACK response

 4. The PHY will return the ACK/NACK response information in the **UCI.indication** message

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/ea1669b0-d582-4371-8d1a-eae3fbe17bce)

-[image reference](https://hackmd.io/@MingHung/StudyBook/%2F%40MingHung%2FFAPI#22-slot-P7)

![H1HzOxUrn](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/e2b2f13c-5685-4085-88fa-e6d44769dd63)

- With DCI Format 1-1, the DL SCH channel can send two data transport blocks to a UE. This requires a single PDCCH (DCI) PDU, a single PDSCH PDU and two MAC PDUs.
- To initiate a transmission of two data transport. blocks, the L2/L3 software must provide the following information:

  1. In the first transmission slot in the DL_TTI.request a PDSCH and PDCCH (DCI) PDU is included. The PDCCH PDU contains control regarding the DL frame transmission. A PDSCH PDU includes two codewords, one for each transport block specified in the DCI PDU.
  2. In TX_DATA.request two MAC PDUs containing the data are included.

- remaining behaviour is identical to single yaler transmission

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/ac38c722-b73c-4af2-bec8-42902f23e4e3)

- Multi-slot transmission is also an option for the DL-SCH, where the same MAC PDU is transmitted for N slots. The procedure is shown in Figure 2-31, and the L2/L3 must provide the following information:
  1. In DL_TTI.request a PDSCH PDU and PDCCH (DCI) PDU is included. The PDCCH PDU contains control regarding the DL frame transmission and the UE will have previously been configured to be aware that multi-slot transmission is used.
  2. In TX_DATA.request a MAC PDUs containing the data is included.
  3. The multi-slot transmission can be over 2,4 or 8 slots and for the remaining slots the L2/L3 software must provide the following information:
     1. In DL_TTI.request a PDSCH PDU is included. The PDSCH PDU contains the information for this slot, for example, in multi-slot transmission the incremental redundancy version changes per slot.
     2. In TX_DATA.request MAC PDU(s) containing the data is/are included

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/9ced6d44-c454-4c01-ad68-35ec6bacdd0c)

## 2.2.5.4 Downlink Reference Signals

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/b3954e33-3e6e-4caa-9eba-c14a06c96a26)

- [DMRS](https://www.sharetechnote.com/html/5G/5G_PDSCH_DMRS.html) for PDSCH and PDCCH
- [PTRS](https://www.sharetechnote.com/html/5G/5G_PTRS_DL.html) for PDSCH
- [CSI-RS](https://www.sharetechnote.com/html/5G/5G_CSI_RS.html)
- [PRS](https://www.sharetechnote.com/html/5G/5G_Positioning.html#:~:text=The%205G%20Positioning%20Reference%20Signal,networks%20to%20support%20positioning%20services.)

- CSI-RS and PRS transmissions are not dependent on PDSCH transmission, or on each other. Instead, CSI-RS or PRS can be sent to a UE in the same slot as a PDSCH transmission, or in a slot with no PDSCH transmission for the UE. There is also no dependency between CSI-RS and PRS transmissions.

## 2.2.6 Uplink

## 2.2.6.1 RACH
- The RACH transport channel is **used by the UE to send data to the gNB when it has no scheduled resources**
- the L2/L3 software can indicate to the UE that it should initiate a RACH procedure.
- In the scope of the PHY API, the RACH procedure begins when the PHY receives an **UL_TTI.request message** indicating the presence of a PRACH slot.

-  To configure a RACH procedure the L2/L3 software must provide the following information:
  1. The **UL_TTI.request** is sent to the PHY including a RACH PDU
  2. If a UE decides to RACH, and a preamble is detected by the PHY:
     1. The PHY will include 1 RACH PDU for each FD and TD occasion in the **RACH.indication** message. __This RACH PDU includes all detected preambles__
  3. If no RACH preamble is detected by the PHY, then **no** **RACH.indication** message is sent

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/e64c33f3-619d-4b90-a914-d0024d645fc4)

## 2.2.6.2 UL-SCH
- The UL-SCH transport channel is used to send data from the UE to the gNB
- HARQ is always applied on the UL-SCH transport channel and the ACK/NACK value is indicated when the next transmission for the HARQ process is scheduled via DCI. Therefore, included in the next iteration of this procedure.
- To transmit an UL-SCH PDU, the L2/L3 software must provide the following information:
 1. Within the **UL_DCI.request** for slot N a DCI PDU is included. The DCI PDU contains control information regarding the **UL frame transmission** being scheduled and indicates new data or retransmission for a specified HARQ process.
 2. In **UL_TTI.request** for slot N+K1 an PUSCH PDU is included, where the value of K1 is variable
 3. The PHY will return CRC information for the received data in the **CRC.indication** message
 4. The PHY will return the received uplink data in the **RX_DATA.indication** message.
 5. If UCI information was expected in the uplink slot, the PHY will return the **UCI.indication** message.(opt)

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/4a611a13-1562-4fde-8113-b021798a8138)

## 2.2.6.3 SRS
- The sounding reference signal (SRS) is used by L2/L3 software to determine the **quality of the uplink channel**.
- The PHY will return the SRS response to the L2/L3 software in the **SRS.indication** message

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/6077013a-bbde-4a0c-b8d2-8877fa432a4d)

## 2.2.6.4 CSI
- The CSI reporting mechanism is used by the L2/L3 software to determine the quality of the downlink channel
- For an aperiodic report the PDCCH PDU is included in the **UL_DCI.request**. This instructs the UE to send a CSI report. For periodic CSI report no explicit DCI information is sent.
- If a PUSCH is scheduled for UCI then a PUSCH PDU is included with the CSI configuration information.
- Otherwise, a PUCCH is scheduled with the CSI configuration information.
- The PHY will return the CSI report to the L2/L3 software in the **UCI.indication** message

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/53edeb87-1ffd-4e69-9381-dfe81e593c73)

## 2.2.6.5 SR
- The scheduling request (SR) procedure is used by the UE to request additional uplink bandwidth
- The L2/L3 software configures the **SR procedure during the RRC connection procedure.**
- The PHY will return the SR to the L2/L3 software in the **UCI.indication**
message.

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/f3b215c1-80c9-4086-a38d-38a7160b7f70)

## 2.2.6.6 Uplink Reference Signals
- [DMRS](https://www.sharetechnote.com/html/5G/5G_PDSCH_DMRS.html) for PUSCH and PUCCH
- [PTRS](https://www.sharetechnote.com/html/5G/5G_PTRS_DL.html) for PUSCH
- SRS(2.2.6.3 SRS)


- The reference signals transmitted for either PUSCH or PUCCH are included in the UL_TTI.request PUSCH or PUCCH PDUs, respectively. However, to transmit a SRS the UL_TTI.request includes a SRS PDU

![image](https://github.com/KRIISHSHARMA/FAPI/assets/86760658/651bbd46-022c-4f99-98de-4b5f1232eccc)


















